<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Receta IMSS 2025</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
<style>
body {
  font-family: Arial, sans-serif;
  background-color: white;
  margin: 0;
  padding: 20px;
}
.container {
  max-width: 800px;
  margin: auto;
}
form {
  background: #f5f5f5;
  padding: 20px;
  border-radius: 8px;
  margin-bottom: 20px;
}
label {
  font-weight: bold;
}
input, textarea {
  width: 100%;
  margin-bottom: 10px;
  padding: 8px;
  border: 1px solid #ccc;
}
button {
  background-color: #007bff;
  color: white;
  border: none;
  padding: 10px 15px;
  border-radius: 5px;
  cursor: pointer;
  margin-right: 5px;
}
button:hover {
  background-color: #0056b3;
}
#receta {
  border: 1px solid black;
  padding: 20px;
  background: white;
  width: 794px;
  margin: auto;
}
.header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
}
.header img {
  width: 80px;
  height: 80px;
}
.header .info {
  border: 1px solid black;
  padding: 10px;
  font-size: 12px;
}
h3 {
  text-align: center;
  margin: 10px 0;
}
.table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 5px;
}
.table td, .table th {
  border: 1px solid black;
  padding: 5px;
  font-size: 12px;
}
.firma {
  text-align: center;
  margin-top: 10px;
  font-size: 12px;
}
.footer {
  text-align: center;
  font-size: 12px;
  margin-top: 15px;
}
#firmaImg {
  max-width: 200px;
  max-height: 80px;
  display: block;
  margin: 10px auto;
}
.qr {
  text-align: right;
}
</style>
</head>
<body>

<div class="container">
  <h2>üö® Receta IMSS 2025 ‚Äî Formulario üö®</h2>
  <form id="formulario">
    <label>Direcci√≥n IMSS:</label>
    <input type="text" id="direccion">
    <label>Delegaci√≥n o Estado:</label>
    <input type="text" id="delegacion">
    <label>Fecha Receta:</label>
    <input type="text" id="fecha">
    <label>NSS:</label>
    <input type="text" id="nss">
    <label>Nombre del Paciente:</label>
    <input type="text" id="nombre">
    <label>CURP:</label>
    <input type="text" id="curp">
    <label>Fecha de Nacimiento:</label>
    <input type="text" id="nacimiento">
    <label>Cl√≠nica:</label>
    <input type="text" id="clinica">
    <label>Consultorio:</label>
    <input type="text" id="consultorio">
    <label>Turno:</label>
    <input type="text" id="turno">
    <label>Medicamentos con su MG:</label>
    <textarea id="medicamentos" rows="5"></textarea>

    <label>Subir firma del m√©dico (imagen PNG o JPG):</label>
    <input type="file" id="firmaFile" accept="image/*">

    <button type="button" onclick="llenarReceta()">Generar Receta</button>
    <button type="button" onclick="generarQR()">Generar QR</button>
    <button type="button" onclick="descargarPDF()">Descargar PDF</button>
  </form>

  <div id="receta">
    <div class="header">
      <div>
        <!-- Puedes cambiar este logo -->
        <img src="logo.png" alt="Logo IMSS">
        <p><strong>INSTITUTO MEXICANO DEL SEGURO SOCIAL</strong><br>SEGURIDAD Y SOLIDARIDAD SOCIAL</p>
      </div>
      <div class="info">
        <p><strong>NSS:</strong> <span id="r_nss"></span><br>
        <strong>NOMBRE DEL PACIENTE:</strong> <span id="r_nombre"></span><br>
        <strong>CURP:</strong> <span id="r_curp"></span><br>
        <strong>DELEGACI√ìN:</strong> <span id="r_delegacion"></span><br>
        <strong>UNIDAD:</strong> <span id="r_clinica"></span><br>
        <strong>CONSULTORIO:</strong> <span id="r_consultorio"></span><br>
        <strong>TURNO:</strong> <span id="r_turno"></span><br>
        <strong>Folio:</strong> <span id="r_folio"></span></p>
      </div>
    </div>

    <h3>RECETA INDIVIDUAL</h3>
    <p><strong>Direcci√≥n:</strong> <span id="r_direccion"></span></p>

    <table class="table">
      <tr>
        <th>Fecha:</th>
        <td id="r_fecha"></td>
        <th>Primer Nivel de Atenci√≥n</th>
      </tr>
    </table>

    <div id="r_medicamentos" style="margin-top:10px; font-size:12px;"></div>

    <div class="qr">
      <canvas id="qrCanvas"></canvas>
    </div>

    <div class="firma">
      <p><strong>Nombre y firma del M√©dico:</strong></p>
      <img id="firmaImg" src="" alt="Firma del m√©dico">
      <p><strong>C√©dula Profesional:</strong> ____________________<br>
      <strong>Matr√≠cula:</strong> ____________________</p>
    </div>

    <div class="footer">
      <p>ACUDIR EN ESTE MOMENTO A LA FARMACIA</p>
    </div>
  </div>
</div>

<script>
let folio = '';

function generarFolio() {
  const random = Math.floor(Math.random() * 1000000000);
  folio = '3021' + random.toString().padStart(8, '0');
  document.getElementById("r_folio").innerText = folio;
}

function llenarReceta() {
  generarFolio();
  document.getElementById("r_direccion").innerText = document.getElementById("direccion").value;
  document.getElementById("r_delegacion").innerText = document.getElementById("delegacion").value;
  document.getElementById("r_fecha").innerText = document.getElementById("fecha").value;
  document.getElementById("r_nss").innerText = document.getElementById("nss").value;
  document.getElementById("r_nombre").innerText = document.getElementById("nombre").value;
  document.getElementById("r_curp").innerText = document.getElementById("curp").value;
  document.getElementById("r_clinica").innerText = document.getElementById("clinica").value;
  document.getElementById("r_consultorio").innerText = document.getElementById("consultorio").value;
  document.getElementById("r_turno").innerText = document.getElementById("turno").value;
  document.getElementById("r_medicamentos").innerText = document.getElementById("medicamentos").value;
}

document.getElementById("firmaFile").addEventListener("change", function(event) {
  const file = event.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = function(e) {
      document.getElementById("firmaImg").src = e.target.result;
    }
    reader.readAsDataURL(file);
  }
});

function generarQR() {
  if (!folio) {
    alert("Primero genera la receta para obtener un folio.");
    return;
  }
  const qr = new QRious({
    element: document.getElementById("qrCanvas"),
    value: folio,
    size: 100
  });
}

function descargarPDF() {
  const element = document.getElementById("receta");
  const opt = {
    margin: 0,
    filename: 'receta_imss_2025.pdf',
    image: { type: 'jpeg', quality: 1 },
    html2canvas: { scale: 2 },
    jsPDF: { unit: 'px', format: 'a4', orientation: 'portrait' }
  };
  html2pdf().set(opt).from(element).save();
}
</script>

</body>
</html>
